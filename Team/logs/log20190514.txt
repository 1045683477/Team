2019-05-14 11:39:16.965 +08:00 [INF] User profile is available. Using 'C:\Users\10456\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2019-05-14 11:39:18.666 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger  
2019-05-14 11:39:18.973 +08:00 [INF] Request finished in 307.8143ms 301 
2019-05-14 11:39:18.977 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html  
2019-05-14 11:39:19.223 +08:00 [INF] Request finished in 246.3276ms 200 text/html
2019-05-14 11:39:19.287 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/swagger-ui.css  
2019-05-14 11:39:19.287 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/swagger-ui-bundle.js  
2019-05-14 11:39:19.288 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/swagger-ui-standalone-preset.js  
2019-05-14 11:39:19.342 +08:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2019-05-14 11:39:19.342 +08:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2019-05-14 11:39:19.347 +08:00 [INF] Request finished in 59.6895ms 200 application/javascript
2019-05-14 11:39:19.347 +08:00 [INF] Request finished in 60.3817ms 200 text/css
2019-05-14 11:39:19.349 +08:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2019-05-14 11:39:19.351 +08:00 [INF] Request finished in 64.412ms 200 application/javascript
2019-05-14 11:39:20.162 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json  
2019-05-14 11:39:20.214 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/favicon-32x32.png  
2019-05-14 11:39:20.218 +08:00 [INF] Sending file. Request path: '/favicon-32x32.png'. Physical path: 'N/A'
2019-05-14 11:39:20.224 +08:00 [INF] Request finished in 9.9339ms 200 image/png
2019-05-14 11:39:20.356 +08:00 [INF] Request finished in 194.243ms 200 application/json;charset=utf-8
2019-05-14 11:39:24.786 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Login/UserLoginApi application/json-patch+json 49
2019-05-14 11:39:24.890 +08:00 [INF] Executing endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 11:39:24.916 +08:00 [INF] Route matched with {action = "UserLoginApi", controller = "Login"}. Executing action Team.Controllers.LoginController.UserLoginApi (Team)
2019-05-14 11:39:25.568 +08:00 [INF] Executing action method Team.Controllers.LoginController.UserLoginApi (Team) with arguments (["Team.Model.AutoMappers.UserMapper.UserLoginMap"]) - Validation state: "Valid"
2019-05-14 11:39:25.860 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 11:39:27.732 +08:00 [INF] Executed DbCommand (1,503ms) [Parameters=[@__account_0='?' (Size = 4000), @__password_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE ([x].[Account] = @__account_0) AND ([x].[Password] = @__password_1)
2019-05-14 11:39:27.842 +08:00 [INF] 用户 1登陆成功
2019-05-14 11:39:27.848 +08:00 [INF] Executed action method Team.Controllers.LoginController.UserLoginApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 2261.3385000000003ms.
2019-05-14 11:39:27.865 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 11:39:27.878 +08:00 [INF] Executed action Team.Controllers.LoginController.UserLoginApi (Team) in 2957.0831000000003ms
2019-05-14 11:39:27.883 +08:00 [INF] Executed endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 11:39:27.890 +08:00 [INF] Request finished in 3104.1634ms 200 application/json; charset=utf-8
2019-05-14 11:39:54.699 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 11:39:54.720 +08:00 [INF] Successfully validated the token.
2019-05-14 11:39:54.725 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 11:39:54.730 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 11:39:54.745 +08:00 [INF] Authorization was successful.
2019-05-14 11:39:54.791 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 11:39:54.805 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 11:39:55.019 +08:00 [INF] Executed DbCommand (182ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 11:39:55.071 +08:00 [INF] Executed DbCommand (30ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 11:39:55.692 +08:00 [ERR] Failed executing DbCommand (499ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
System.Data.SqlClient.SqlException (0x80131904): 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
ClientConnectionId:6647cd5b-5c83-4a8a-8dc7-6616be60da5a
Error Number:2601,State:1,Class:14
2019-05-14 11:39:55.840 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 11:39:56.060 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 1323.3764ms
2019-05-14 11:39:56.063 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 11:39:56.067 +08:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 11:39:56.171 +08:00 [INF] Request finished in 1472.3125ms 500 text/html; charset=utf-8
2019-05-14 11:44:09.242 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 11:44:09.246 +08:00 [INF] Successfully validated the token.
2019-05-14 11:44:09.250 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 11:44:09.254 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 11:44:09.257 +08:00 [INF] Authorization was successful.
2019-05-14 11:44:09.284 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 11:44:56.206 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 11:44:56.250 +08:00 [INF] Executed DbCommand (33ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 11:45:57.502 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:31:52.836 +08:00 [INF] User profile is available. Using 'C:\Users\10456\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2019-05-14 12:31:53.928 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger  
2019-05-14 12:31:54.048 +08:00 [INF] Request finished in 124.2835ms 301 
2019-05-14 12:31:54.057 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html  
2019-05-14 12:31:54.259 +08:00 [INF] Request finished in 201.9896ms 200 text/html
2019-05-14 12:31:54.294 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/swagger-ui.css  
2019-05-14 12:31:54.297 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/swagger-ui-standalone-preset.js  
2019-05-14 12:31:54.297 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/swagger-ui-bundle.js  
2019-05-14 12:31:54.343 +08:00 [INF] Sending file. Request path: '/swagger-ui-standalone-preset.js'. Physical path: 'N/A'
2019-05-14 12:31:54.343 +08:00 [INF] Sending file. Request path: '/swagger-ui.css'. Physical path: 'N/A'
2019-05-14 12:31:54.343 +08:00 [INF] Sending file. Request path: '/swagger-ui-bundle.js'. Physical path: 'N/A'
2019-05-14 12:31:54.347 +08:00 [INF] Request finished in 53.325ms 200 text/css
2019-05-14 12:31:54.347 +08:00 [INF] Request finished in 50.6523ms 200 application/javascript
2019-05-14 12:31:54.348 +08:00 [INF] Request finished in 51.0484ms 200 application/javascript
2019-05-14 12:31:54.924 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json  
2019-05-14 12:31:55.077 +08:00 [INF] Request finished in 153.2971ms 200 application/json;charset=utf-8
2019-05-14 12:32:16.978 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Login/UserLoginApi application/json-patch+json 49
2019-05-14 12:32:17.048 +08:00 [INF] Executing endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 12:32:17.071 +08:00 [INF] Route matched with {action = "UserLoginApi", controller = "Login"}. Executing action Team.Controllers.LoginController.UserLoginApi (Team)
2019-05-14 12:32:17.551 +08:00 [INF] Executing action method Team.Controllers.LoginController.UserLoginApi (Team) with arguments (["Team.Model.AutoMappers.UserMapper.UserLoginMap"]) - Validation state: "Valid"
2019-05-14 12:32:17.769 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:32:18.059 +08:00 [INF] Executed DbCommand (57ms) [Parameters=[@__account_0='?' (Size = 4000), @__password_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE ([x].[Account] = @__account_0) AND ([x].[Password] = @__password_1)
2019-05-14 12:32:18.132 +08:00 [INF] 用户 1登陆成功
2019-05-14 12:32:18.137 +08:00 [INF] Executed action method Team.Controllers.LoginController.UserLoginApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 570.4167ms.
2019-05-14 12:32:18.153 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:32:18.165 +08:00 [INF] Executed action Team.Controllers.LoginController.UserLoginApi (Team) in 1089.4102ms
2019-05-14 12:32:18.169 +08:00 [INF] Executed endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 12:32:18.172 +08:00 [INF] Request finished in 1194.508ms 200 application/json; charset=utf-8
2019-05-14 12:33:24.600 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:33:24.621 +08:00 [INF] Successfully validated the token.
2019-05-14 12:33:24.628 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:33:24.634 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:33:24.647 +08:00 [INF] Authorization was successful.
2019-05-14 12:33:24.694 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:33:36.480 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:33:36.556 +08:00 [INF] Executed DbCommand (60ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:33:49.357 +08:00 [INF] Executed DbCommand (30ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:34:02.304 +08:00 [ERR] Failed executing DbCommand (41ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
System.Data.SqlClient.SqlException (0x80131904): 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
ClientConnectionId:843e6b3d-220a-4d91-941e-8b3db75ff60b
Error Number:2601,State:1,Class:14
2019-05-14 12:34:02.370 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 12:34:02.533 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 37896.8906ms
2019-05-14 12:34:02.536 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:34:02.539 +08:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 12:34:02.615 +08:00 [INF] Request finished in 38015.1681ms 500 text/html; charset=utf-8
2019-05-14 12:34:28.748 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:34:28.751 +08:00 [INF] Successfully validated the token.
2019-05-14 12:34:28.754 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:34:28.759 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:34:28.763 +08:00 [INF] Authorization was successful.
2019-05-14 12:34:28.787 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:34:28.791 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:34:28.821 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:34:28.852 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:34:33.372 +08:00 [ERR] Failed executing DbCommand (32ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
System.Data.SqlClient.SqlException (0x80131904): 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
ClientConnectionId:843e6b3d-220a-4d91-941e-8b3db75ff60b
Error Number:2601,State:1,Class:14
2019-05-14 12:34:33.386 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 12:34:33.510 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 4747.2312ms
2019-05-14 12:34:33.513 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:34:33.515 +08:00 [ERR] An unhandled exception has occurred while executing the request.
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while updating the entries. See the inner exception for details. ---> System.Data.SqlClient.SqlException: 不能在具有唯一索引“IX_RunTeams_UserId”的对象“dbo.RunTeams”中插入重复键的行。重复键值为 (1)。
语句已终止。
   at System.Data.SqlClient.SqlCommand.<>c.<ExecuteDbDataReaderAsync>b__122_0(Task`1 result)
   at System.Threading.Tasks.ContinuationResultTaskFromResultTask`2.InnerInvoke()
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state)
--- End of stack trace from previous location where exception was thrown ---
   at System.Threading.Tasks.Task.ExecuteWithThreadLocal(Task& currentTaskSlot)
--- End of stack trace from previous location where exception was thrown ---
   at Microsoft.EntityFrameworkCore.Storage.Internal.RelationalCommand.ExecuteAsync(IRelationalConnection connection, DbCommandMethod executeMethod, IReadOnlyDictionary`2 parameterValues, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   --- End of inner exception stack trace ---
   at Microsoft.EntityFrameworkCore.Update.ReaderModificationCommandBatch.ExecuteAsync(IRelationalConnection connection, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.Update.Internal.BatchExecutor.ExecuteAsync(DbContext _, ValueTuple`2 parameters, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.SqlServer.Storage.Internal.SqlServerExecutionStrategy.ExecuteAsync[TState,TResult](TState state, Func`4 operation, Func`4 verifySucceeded, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 12:34:33.559 +08:00 [INF] Request finished in 4810.8483ms 500 text/html; charset=utf-8
2019-05-14 12:36:36.066 +08:00 [INF] User profile is available. Using 'C:\Users\10456\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2019-05-14 12:36:37.259 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html  
2019-05-14 12:36:37.536 +08:00 [INF] Request finished in 280.6571ms 200 text/html
2019-05-14 12:36:38.244 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json  
2019-05-14 12:36:38.422 +08:00 [INF] Request finished in 178.1496ms 200 application/json;charset=utf-8
2019-05-14 12:36:47.647 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:36:47.731 +08:00 [INF] Successfully validated the token.
2019-05-14 12:36:47.770 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:36:47.792 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:36:47.804 +08:00 [INF] Authorization was successful.
2019-05-14 12:36:48.228 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:36:48.442 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:36:48.677 +08:00 [INF] Executed DbCommand (48ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:36:48.769 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:37:08.570 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 12:37:08.575 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 20329.5664ms.
2019-05-14 12:37:08.587 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:37:08.599 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 20802.243000000002ms
2019-05-14 12:37:08.602 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:37:08.604 +08:00 [INF] Request finished in 20957.2899ms 500 application/json; charset=utf-8
2019-05-14 12:37:17.720 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 12:37:17.723 +08:00 [INF] Successfully validated the token.
2019-05-14 12:37:17.729 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:37:17.734 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 12:37:17.736 +08:00 [INF] Authorization was successful.
2019-05-14 12:37:17.760 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 12:37:17.783 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:37:17.823 +08:00 [INF] Executed DbCommand (27ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 12:37:17.946 +08:00 [INF] 用户 1 删除队伍成功
2019-05-14 12:37:17.947 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 183.5449ms.
2019-05-14 12:37:17.949 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:37:17.951 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 214.946ms
2019-05-14 12:37:17.953 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:37:17.960 +08:00 [ERR] Connection id "0HLMO4N019NR3", Request id "0HLMO4N019NR3:00000004": An unhandled exception was thrown by the application.
System.InvalidOperationException: The connection does not support MultipleActiveResultSets.
   at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)
   at System.Data.SqlClient.SqlInternalTransaction.Rollback()
   at System.Data.SqlClient.SqlTransaction.Dispose(Boolean disposing)
   at System.Data.Common.DbTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ClearTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.EntityFrameworkCore.DbContext.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.AspNetCore.Hosting.Internal.RequestServicesFeature.Dispose()
   at Microsoft.AspNetCore.Http.HttpResponse.<>c.<.cctor>b__30_1(Object disposable)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.FireOnCompletedAwaited(Stack`1 onCompleted)
2019-05-14 12:37:18.024 +08:00 [INF] Request finished in 304.2271ms 200 application/json; charset=utf-8
2019-05-14 12:37:18.316 +08:00 [INF] Executed DbCommand (427ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [RunTeams]
WHERE [Id] = @p0;
SELECT @@ROWCOUNT;
2019-05-14 12:37:24.565 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:37:24.569 +08:00 [INF] Successfully validated the token.
2019-05-14 12:37:24.571 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:37:24.573 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:37:24.577 +08:00 [INF] Authorization was successful.
2019-05-14 12:37:24.604 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:37:24.612 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:37:24.641 +08:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:37:24.668 +08:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:43:13.300 +08:00 [INF] User profile is available. Using 'C:\Users\10456\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2019-05-14 12:43:14.673 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html  
2019-05-14 12:43:14.988 +08:00 [INF] Request finished in 318.0564ms 200 text/html
2019-05-14 12:43:15.519 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json  
2019-05-14 12:43:15.680 +08:00 [INF] Request finished in 161.4045ms 200 application/json;charset=utf-8
2019-05-14 12:43:26.580 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Login/UserLoginApi application/json-patch+json 49
2019-05-14 12:43:26.667 +08:00 [INF] Executing endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 12:43:26.692 +08:00 [INF] Route matched with {action = "UserLoginApi", controller = "Login"}. Executing action Team.Controllers.LoginController.UserLoginApi (Team)
2019-05-14 12:43:27.204 +08:00 [INF] Executing action method Team.Controllers.LoginController.UserLoginApi (Team) with arguments (["Team.Model.AutoMappers.UserMapper.UserLoginMap"]) - Validation state: "Valid"
2019-05-14 12:43:27.416 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:43:27.833 +08:00 [INF] Executed DbCommand (44ms) [Parameters=[@__account_0='?' (Size = 4000), @__password_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE ([x].[Account] = @__account_0) AND ([x].[Password] = @__password_1)
2019-05-14 12:43:27.906 +08:00 [INF] 用户 1登陆成功
2019-05-14 12:43:27.912 +08:00 [INF] Executed action method Team.Controllers.LoginController.UserLoginApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 691.2369ms.
2019-05-14 12:43:27.927 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:43:27.939 +08:00 [INF] Executed action Team.Controllers.LoginController.UserLoginApi (Team) in 1240.3485ms
2019-05-14 12:43:27.943 +08:00 [INF] Executed endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 12:43:27.951 +08:00 [INF] Request finished in 1370.848ms 200 application/json; charset=utf-8
2019-05-14 12:43:44.315 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:43:44.332 +08:00 [INF] Successfully validated the token.
2019-05-14 12:43:44.337 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:43:44.341 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:43:44.355 +08:00 [INF] Authorization was successful.
2019-05-14 12:43:44.382 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:43:44.389 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:43:44.448 +08:00 [INF] Executed DbCommand (45ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:43:44.492 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:43:44.692 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 12:43:44.705 +08:00 [INF] Executed DbCommand (145ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 12:43:44.828 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 480.50030000000004ms
2019-05-14 12:43:44.832 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:43:44.835 +08:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 12:43:44.897 +08:00 [INF] Request finished in 582.5367ms 500 text/html; charset=utf-8
2019-05-14 12:45:07.013 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:45:07.023 +08:00 [INF] Successfully validated the token.
2019-05-14 12:45:07.025 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:45:07.027 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:45:07.030 +08:00 [INF] Authorization was successful.
2019-05-14 12:45:07.056 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:45:07.060 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:45:07.101 +08:00 [INF] Executed DbCommand (37ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:45:24.653 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:46:27.065 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 12:46:27.067 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 80007.3909ms.
2019-05-14 12:46:27.071 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:46:27.083 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 80053.0221ms
2019-05-14 12:46:27.085 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:46:27.087 +08:00 [INF] Request finished in 80074.0228ms 500 application/json; charset=utf-8
2019-05-14 12:46:34.574 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:46:34.578 +08:00 [INF] Successfully validated the token.
2019-05-14 12:46:34.579 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:46:34.580 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:46:34.582 +08:00 [INF] Authorization was successful.
2019-05-14 12:46:34.604 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:46:34.611 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:46:34.641 +08:00 [INF] Executed DbCommand (27ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:46:40.983 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:46:42.535 +08:00 [INF] Executed DbCommand (1,543ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 12:47:10.363 +08:00 [INF] Executed DbCommand (160ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 12:47:10.516 +08:00 [INF] Executed DbCommand (134ms) [Parameters=[@p5='?' (Size = 4000), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunParticipantses] ([Name], [RunTeamId], [Sex], [UserId])
VALUES (@p5, @p6, @p7, @p8);
SELECT [Id]
FROM [RunParticipantses]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 12:47:10.533 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 12:47:10.537 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 35925.750400000004ms.
2019-05-14 12:47:10.540 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:47:10.542 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 35959.9956ms
2019-05-14 12:47:10.544 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:47:10.547 +08:00 [INF] Request finished in 35972.7526ms 201 application/json; charset=utf-8
2019-05-14 12:47:55.276 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:47:55.280 +08:00 [INF] Successfully validated the token.
2019-05-14 12:47:55.282 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:47:55.285 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:47:55.293 +08:00 [INF] Authorization was successful.
2019-05-14 12:47:55.322 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:47:55.326 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:47:55.355 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:47:58.480 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:48:00.851 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 12:48:00.853 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 5527.1403ms.
2019-05-14 12:48:00.856 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:48:00.858 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 5565.1738000000005ms
2019-05-14 12:48:00.864 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:48:00.868 +08:00 [INF] Request finished in 5591.6095ms 500 application/json; charset=utf-8
2019-05-14 12:48:17.551 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 12:48:17.554 +08:00 [INF] Successfully validated the token.
2019-05-14 12:48:17.557 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:48:17.566 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 12:48:17.568 +08:00 [INF] Authorization was successful.
2019-05-14 12:48:17.591 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 12:48:17.596 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:48:17.633 +08:00 [INF] Executed DbCommand (29ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 12:48:17.664 +08:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:48:17.705 +08:00 [INF] 用户 1 删除队伍成功
2019-05-14 12:48:17.706 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 111.7243ms.
2019-05-14 12:48:17.709 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:48:17.711 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 142.5993ms
2019-05-14 12:48:17.713 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:48:17.716 +08:00 [ERR] Connection id "0HLMO4QMDDFTJ", Request id "0HLMO4QMDDFTJ:00000008": An unhandled exception was thrown by the application.
System.InvalidOperationException: The connection does not support MultipleActiveResultSets.
   at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)
   at System.Data.SqlClient.SqlInternalTransaction.Rollback()
   at System.Data.SqlClient.SqlTransaction.Dispose(Boolean disposing)
   at System.Data.Common.DbTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ClearTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.EntityFrameworkCore.DbContext.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.AspNetCore.Hosting.Internal.RequestServicesFeature.Dispose()
   at Microsoft.AspNetCore.Http.HttpResponse.<>c.<.cctor>b__30_1(Object disposable)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.FireOnCompletedAwaited(Stack`1 onCompleted)
2019-05-14 12:48:17.738 +08:00 [INF] Request finished in 187.5559ms 200 application/json; charset=utf-8
2019-05-14 12:48:17.872 +08:00 [INF] Executed DbCommand (192ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [RunTeams]
WHERE [Id] = @p0;
SELECT @@ROWCOUNT;
2019-05-14 12:48:17.900 +08:00 [INF] Executed DbCommand (22ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 12:48:23.101 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 12:48:23.104 +08:00 [INF] Successfully validated the token.
2019-05-14 12:48:23.105 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:48:23.109 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 12:48:23.114 +08:00 [INF] Authorization was successful.
2019-05-14 12:48:23.135 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 12:48:23.138 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:48:23.169 +08:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 12:48:23.199 +08:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:48:23.205 +08:00 [INF] 用户 1 自身并没有创建队伍，删除失败！
2019-05-14 12:48:23.206 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 67.7044ms.
2019-05-14 12:48:23.214 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:48:23.216 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 102.06400000000001ms
2019-05-14 12:48:23.218 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:48:23.220 +08:00 [INF] Request finished in 118.9673ms 404 application/json; charset=utf-8
2019-05-14 12:48:28.434 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:48:28.436 +08:00 [INF] Successfully validated the token.
2019-05-14 12:48:28.438 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:48:28.441 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:48:28.448 +08:00 [INF] Authorization was successful.
2019-05-14 12:48:28.479 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:48:28.482 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:48:28.521 +08:00 [INF] Executed DbCommand (35ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:48:28.552 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:48:31.373 +08:00 [INF] Executed DbCommand (2,814ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 12:48:31.375 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 12:48:31.503 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 3056.0354ms
2019-05-14 12:48:31.506 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:48:31.509 +08:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 12:48:31.548 +08:00 [INF] Request finished in 3114.2019ms 500 text/html; charset=utf-8
2019-05-14 12:50:43.940 +08:00 [INF] User profile is available. Using 'C:\Users\10456\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2019-05-14 12:50:45.446 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html  
2019-05-14 12:50:45.737 +08:00 [INF] Request finished in 297.6871ms 200 text/html
2019-05-14 12:50:46.275 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json  
2019-05-14 12:50:46.455 +08:00 [INF] Request finished in 180.5608ms 200 application/json;charset=utf-8
2019-05-14 12:51:13.914 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Login/UserLoginApi application/json-patch+json 49
2019-05-14 12:51:14.000 +08:00 [INF] Executing endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 12:51:14.025 +08:00 [INF] Route matched with {action = "UserLoginApi", controller = "Login"}. Executing action Team.Controllers.LoginController.UserLoginApi (Team)
2019-05-14 12:51:14.292 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Login/UserLoginApi application/json-patch+json 49
2019-05-14 12:51:14.320 +08:00 [INF] Executing endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 12:51:14.323 +08:00 [INF] Route matched with {action = "UserLoginApi", controller = "Login"}. Executing action Team.Controllers.LoginController.UserLoginApi (Team)
2019-05-14 12:51:14.510 +08:00 [INF] Executing action method Team.Controllers.LoginController.UserLoginApi (Team) with arguments (["Team.Model.AutoMappers.UserMapper.UserLoginMap"]) - Validation state: "Valid"
2019-05-14 12:51:14.510 +08:00 [INF] Executing action method Team.Controllers.LoginController.UserLoginApi (Team) with arguments (["Team.Model.AutoMappers.UserMapper.UserLoginMap"]) - Validation state: "Valid"
2019-05-14 12:51:14.748 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:51:14.748 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:51:15.053 +08:00 [INF] Executed DbCommand (46ms) [Parameters=[@__account_0='?' (Size = 4000), @__password_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE ([x].[Account] = @__account_0) AND ([x].[Password] = @__password_1)
2019-05-14 12:51:15.053 +08:00 [INF] Executed DbCommand (46ms) [Parameters=[@__account_0='?' (Size = 4000), @__password_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE ([x].[Account] = @__account_0) AND ([x].[Password] = @__password_1)
2019-05-14 12:51:15.134 +08:00 [INF] 用户 1登陆成功
2019-05-14 12:51:15.134 +08:00 [INF] 用户 1登陆成功
2019-05-14 12:51:15.141 +08:00 [INF] Executed action method Team.Controllers.LoginController.UserLoginApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 615.67500000000007ms.
2019-05-14 12:51:15.141 +08:00 [INF] Executed action method Team.Controllers.LoginController.UserLoginApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 614.7231ms.
2019-05-14 12:51:15.146 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Login/UserLoginApi application/json-patch+json 49
2019-05-14 12:51:15.152 +08:00 [INF] Executing endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 12:51:15.162 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:51:15.163 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:51:15.164 +08:00 [INF] Route matched with {action = "UserLoginApi", controller = "Login"}. Executing action Team.Controllers.LoginController.UserLoginApi (Team)
2019-05-14 12:51:15.197 +08:00 [INF] Executing action method Team.Controllers.LoginController.UserLoginApi (Team) with arguments (["Team.Model.AutoMappers.UserMapper.UserLoginMap"]) - Validation state: "Valid"
2019-05-14 12:51:15.200 +08:00 [INF] Executed action Team.Controllers.LoginController.UserLoginApi (Team) in 1169.5066000000002ms
2019-05-14 12:51:15.200 +08:00 [INF] Executed action Team.Controllers.LoginController.UserLoginApi (Team) in 873.3301ms
2019-05-14 12:51:15.201 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:51:15.203 +08:00 [INF] Executed endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 12:51:15.205 +08:00 [INF] Executed endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 12:51:15.296 +08:00 [INF] Executed DbCommand (85ms) [Parameters=[@__account_0='?' (Size = 4000), @__password_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE ([x].[Account] = @__account_0) AND ([x].[Password] = @__password_1)
2019-05-14 12:51:15.300 +08:00 [INF] Request finished in 1007.5304ms 200 application/json; charset=utf-8
2019-05-14 12:51:15.300 +08:00 [INF] Request finished in 1385.5845ms 200 application/json; charset=utf-8
2019-05-14 12:51:15.304 +08:00 [INF] 用户 1登陆成功
2019-05-14 12:51:15.308 +08:00 [INF] Executed action method Team.Controllers.LoginController.UserLoginApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 108.3379ms.
2019-05-14 12:51:15.312 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:51:15.314 +08:00 [INF] Executed action Team.Controllers.LoginController.UserLoginApi (Team) in 139.591ms
2019-05-14 12:51:15.316 +08:00 [INF] Executed endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 12:51:15.318 +08:00 [INF] Request finished in 171.9601ms 200 application/json; charset=utf-8
2019-05-14 12:51:28.397 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 12:51:28.410 +08:00 [INF] Successfully validated the token.
2019-05-14 12:51:28.413 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:51:28.417 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 12:51:28.430 +08:00 [INF] Authorization was successful.
2019-05-14 12:51:28.456 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 12:51:28.461 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:51:28.510 +08:00 [INF] Executed DbCommand (35ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 12:51:28.547 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:51:28.554 +08:00 [INF] 用户 1 自身并没有创建队伍，删除失败！
2019-05-14 12:51:28.556 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 96.786300000000011ms.
2019-05-14 12:51:28.560 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:51:28.562 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 141.08180000000002ms
2019-05-14 12:51:28.564 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:51:28.566 +08:00 [INF] Request finished in 168.5348ms 404 application/json; charset=utf-8
2019-05-14 12:51:38.764 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:51:38.767 +08:00 [INF] Successfully validated the token.
2019-05-14 12:51:38.769 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:51:38.777 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:51:38.780 +08:00 [INF] Authorization was successful.
2019-05-14 12:51:38.808 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:51:38.814 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:51:38.847 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:51:38.893 +08:00 [INF] Executed DbCommand (27ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:51:38.986 +08:00 [INF] Executed DbCommand (38ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 12:51:39.074 +08:00 [INF] Executed DbCommand (30ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 12:51:39.112 +08:00 [INF] Executed DbCommand (27ms) [Parameters=[@p5='?' (Size = 4000), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunParticipantses] ([Name], [RunTeamId], [Sex], [UserId])
VALUES (@p5, @p6, @p7, @p8);
SELECT [Id]
FROM [RunParticipantses]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 12:51:39.123 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 12:51:39.125 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 313.4386ms.
2019-05-14 12:51:39.129 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:51:39.130 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 350.446ms
2019-05-14 12:51:39.136 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:51:39.138 +08:00 [INF] Request finished in 373.9593ms 201 application/json; charset=utf-8
2019-05-14 12:51:42.605 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:51:42.607 +08:00 [INF] Successfully validated the token.
2019-05-14 12:51:42.608 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:51:42.611 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:51:42.614 +08:00 [INF] Authorization was successful.
2019-05-14 12:51:42.639 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:51:42.644 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:51:42.677 +08:00 [INF] Executed DbCommand (31ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:51:42.709 +08:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:51:42.715 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 12:51:42.716 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 72.7535ms.
2019-05-14 12:51:42.720 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:51:42.721 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 107.50240000000001ms
2019-05-14 12:51:42.724 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:51:42.726 +08:00 [INF] Request finished in 121.199ms 500 application/json; charset=utf-8
2019-05-14 12:51:50.748 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 12:51:50.751 +08:00 [INF] Successfully validated the token.
2019-05-14 12:51:50.753 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:51:50.756 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 12:51:50.759 +08:00 [INF] Authorization was successful.
2019-05-14 12:51:50.783 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 12:51:50.787 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:51:50.815 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 12:51:50.844 +08:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:51:50.885 +08:00 [INF] 用户 1 删除队伍成功
2019-05-14 12:51:50.887 +08:00 [INF] Executed DbCommand (30ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [RunTeams]
WHERE [Id] = @p0;
SELECT @@ROWCOUNT;
2019-05-14 12:51:50.887 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 99.8871ms.
2019-05-14 12:51:50.910 +08:00 [INF] Executed DbCommand (19ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 12:51:50.911 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:51:50.919 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 159.8066ms
2019-05-14 12:51:50.923 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:51:50.925 +08:00 [INF] Request finished in 176.0804ms 200 application/json; charset=utf-8
2019-05-14 12:51:56.194 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:51:56.197 +08:00 [INF] Successfully validated the token.
2019-05-14 12:51:56.199 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:51:56.202 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:51:56.207 +08:00 [INF] Authorization was successful.
2019-05-14 12:51:56.229 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:51:56.237 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:51:56.269 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:51:56.298 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:51:56.332 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 12:51:56.374 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 12:51:56.497 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 290.8313ms
2019-05-14 12:51:56.502 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:51:56.504 +08:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 12:51:56.592 +08:00 [INF] Request finished in 398.6057ms 500 text/html; charset=utf-8
2019-05-14 12:54:31.810 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 12:54:31.814 +08:00 [INF] Successfully validated the token.
2019-05-14 12:54:31.817 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:54:31.819 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 12:54:31.822 +08:00 [INF] Authorization was successful.
2019-05-14 12:54:31.846 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 12:54:31.852 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:54:31.884 +08:00 [INF] Executed DbCommand (27ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 12:54:31.913 +08:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:54:31.918 +08:00 [INF] 用户 1 自身并没有创建队伍，删除失败！
2019-05-14 12:54:31.919 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 67.505400000000009ms.
2019-05-14 12:54:31.923 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:54:31.925 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 102.6575ms
2019-05-14 12:54:31.927 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:54:31.929 +08:00 [INF] Request finished in 119.8133ms 404 application/json; charset=utf-8
2019-05-14 12:55:18.682 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 12:55:18.686 +08:00 [INF] Successfully validated the token.
2019-05-14 12:55:18.691 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:55:18.695 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 12:55:18.697 +08:00 [INF] Authorization was successful.
2019-05-14 12:55:18.725 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 12:55:21.850 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:55:21.882 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 12:55:25.321 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:55:56.909 +08:00 [INF] 用户 1 自身并没有创建队伍，删除失败！
2019-05-14 12:55:56.912 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 38184.3108ms.
2019-05-14 12:55:56.927 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:55:56.929 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 38232.310300000005ms
2019-05-14 12:55:56.932 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:55:56.941 +08:00 [INF] Request finished in 38258.1243ms 404 application/json; charset=utf-8
2019-05-14 12:56:21.427 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:56:21.484 +08:00 [INF] Successfully validated the token.
2019-05-14 12:56:21.486 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:56:21.488 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:56:21.490 +08:00 [INF] Authorization was successful.
2019-05-14 12:56:21.523 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:56:21.530 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:56:21.558 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:56:21.589 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:56:21.624 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 12:56:21.624 +08:00 [INF] Executed DbCommand (29ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 12:56:21.729 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 239.0089ms
2019-05-14 12:56:21.737 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:56:21.741 +08:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 12:56:36.754 +08:00 [ERR] Connection id "0HLMO4USOFTS4", Request id "0HLMO4USOFTS4:00000009": An unhandled exception was thrown by the application.
System.Data.SqlClient.SqlException (0x80131904): Timeout expired.  The timeout period elapsed prior to completion of the operation or the server is not responding. ---> System.ComponentModel.Win32Exception (258): 等待的操作过时。
   at System.Data.SqlClient.SqlConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.SqlInternalConnection.OnError(SqlException exception, Boolean breakConnection, Action`1 wrapCloseInAction)
   at System.Data.SqlClient.TdsParser.ThrowExceptionAndWarning(TdsParserStateObject stateObj, Boolean callerHasConnectionLock, Boolean asyncClose)
   at System.Data.SqlClient.TdsParser.TryRun(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj, Boolean& dataReady)
   at System.Data.SqlClient.TdsParser.Run(RunBehavior runBehavior, SqlCommand cmdHandler, SqlDataReader dataStream, BulkCopySimpleResultSet bulkCopyHandler, TdsParserStateObject stateObj)
   at System.Data.SqlClient.TdsParser.DrainData(TdsParserStateObject stateObj)
   at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)
   at System.Data.SqlClient.SqlInternalTransaction.Rollback()
   at System.Data.SqlClient.SqlTransaction.Dispose(Boolean disposing)
   at System.Data.Common.DbTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ClearTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.EntityFrameworkCore.DbContext.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.AspNetCore.Hosting.Internal.RequestServicesFeature.Dispose()
   at Microsoft.AspNetCore.Http.HttpResponse.<>c.<.cctor>b__30_1(Object disposable)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.FireOnCompletedAwaited(Stack`1 onCompleted)
ClientConnectionId:45a91cd2-ceba-4972-b886-f110238cea92
Error Number:-2,State:0,Class:11
2019-05-14 12:56:36.787 +08:00 [INF] Request finished in 15359.6981ms 500 text/html; charset=utf-8
2019-05-14 12:56:36.788 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:56:36.789 +08:00 [INF] Successfully validated the token.
2019-05-14 12:56:36.791 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:56:36.792 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:56:36.797 +08:00 [INF] Authorization was successful.
2019-05-14 12:56:36.817 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:56:36.821 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:56:36.848 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:56:36.882 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:56:51.809 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 12:56:51.826 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 15005.180600000002ms.
2019-05-14 12:56:51.830 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:56:51.831 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 15034.8624ms
2019-05-14 12:56:51.834 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:56:51.836 +08:00 [INF] Request finished in 15048.4709ms 500 application/json; charset=utf-8
2019-05-14 12:57:34.570 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:57:34.575 +08:00 [INF] Successfully validated the token.
2019-05-14 12:57:34.577 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:57:34.582 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:57:34.589 +08:00 [INF] Authorization was successful.
2019-05-14 12:57:34.614 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:57:34.618 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:57:34.647 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:58:03.737 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:58:15.998 +08:00 [INF] Executed DbCommand (12,254ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 12:58:46.237 +08:00 [INF] Executed DbCommand (156ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 12:58:46.299 +08:00 [INF] Executed DbCommand (56ms) [Parameters=[@p5='?' (Size = 4000), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunParticipantses] ([Name], [RunTeamId], [Sex], [UserId])
VALUES (@p5, @p6, @p7, @p8);
SELECT [Id]
FROM [RunParticipantses]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 12:58:46.308 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 12:58:46.311 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 71692.9696ms.
2019-05-14 12:58:46.319 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:58:46.321 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 71731.8031ms
2019-05-14 12:58:46.324 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:58:46.326 +08:00 [INF] Request finished in 71755.966ms 201 application/json; charset=utf-8
2019-05-14 12:58:59.795 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 12:58:59.800 +08:00 [INF] Successfully validated the token.
2019-05-14 12:58:59.803 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:58:59.807 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 12:58:59.811 +08:00 [INF] Authorization was successful.
2019-05-14 12:58:59.837 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 12:58:59.844 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:58:59.874 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:59:01.705 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 12:59:01.713 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 12:59:01.718 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 1874.4181ms.
2019-05-14 12:59:01.720 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 12:59:01.722 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 1911.3278ms
2019-05-14 12:59:01.724 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 12:59:01.730 +08:00 [INF] Request finished in 1934.9336ms 500 application/json; charset=utf-8
2019-05-14 12:59:14.392 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 12:59:14.395 +08:00 [INF] Successfully validated the token.
2019-05-14 12:59:14.397 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 12:59:14.399 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 12:59:14.405 +08:00 [INF] Authorization was successful.
2019-05-14 12:59:14.433 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 12:59:21.201 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 12:59:21.232 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 12:59:22.264 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:00:01.389 +08:00 [INF] 用户 1 删除队伍成功
2019-05-14 13:00:01.391 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 46955.5265ms.
2019-05-14 13:00:01.394 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:00:01.396 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 46990.903600000005ms
2019-05-14 13:00:01.398 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:00:01.401 +08:00 [ERR] Connection id "0HLMO4USOFTS4", Request id "0HLMO4USOFTS4:0000000D": An unhandled exception was thrown by the application.
System.InvalidOperationException: The connection does not support MultipleActiveResultSets.
   at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)
   at System.Data.SqlClient.SqlInternalTransaction.Rollback()
   at System.Data.SqlClient.SqlTransaction.Dispose(Boolean disposing)
   at System.Data.Common.DbTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ClearTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.EntityFrameworkCore.DbContext.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.AspNetCore.Hosting.Internal.RequestServicesFeature.Dispose()
   at Microsoft.AspNetCore.Http.HttpResponse.<>c.<.cctor>b__30_1(Object disposable)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.FireOnCompletedAwaited(Stack`1 onCompleted)
2019-05-14 13:00:01.423 +08:00 [INF] Request finished in 47031.6531ms 200 application/json; charset=utf-8
2019-05-14 13:00:01.434 +08:00 [INF] Executed DbCommand (73ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [RunTeams]
WHERE [Id] = @p0;
SELECT @@ROWCOUNT;
2019-05-14 13:00:01.470 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:00:41.671 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:00:41.674 +08:00 [INF] Successfully validated the token.
2019-05-14 13:00:41.676 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:00:41.678 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:00:41.682 +08:00 [INF] Authorization was successful.
2019-05-14 13:00:41.709 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:00:41.718 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:00:41.754 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:00:52.317 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:00:56.082 +08:00 [INF] Executed DbCommand (3,745ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:01:00.371 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 13:01:00.509 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 18827.4026ms
2019-05-14 13:01:00.512 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:01:00.516 +08:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 13:01:00.568 +08:00 [INF] Request finished in 18896.7338ms 500 text/html; charset=utf-8
2019-05-14 13:01:09.382 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:01:09.385 +08:00 [INF] Successfully validated the token.
2019-05-14 13:01:09.388 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:01:09.393 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:01:09.397 +08:00 [INF] Authorization was successful.
2019-05-14 13:01:09.422 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:01:09.428 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:01:09.458 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:01:25.077 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:01:30.482 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 13:01:30.484 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 21057.561700000002ms.
2019-05-14 13:01:30.489 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:01:30.491 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 21094.2459ms
2019-05-14 13:01:30.495 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:01:30.497 +08:00 [INF] Request finished in 21115.5293ms 500 application/json; charset=utf-8
2019-05-14 13:02:03.900 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:02:03.903 +08:00 [INF] Successfully validated the token.
2019-05-14 13:02:03.905 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:02:03.907 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:02:03.912 +08:00 [INF] Authorization was successful.
2019-05-14 13:02:03.937 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:02:03.945 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:02:03.974 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:02:08.933 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:02:22.474 +08:00 [INF] Executed DbCommand (863ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:03:30.368 +08:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 13:03:30.395 +08:00 [INF] Executed DbCommand (20ms) [Parameters=[@p5='?' (Size = 4000), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunParticipantses] ([Name], [RunTeamId], [Sex], [UserId])
VALUES (@p5, @p6, @p7, @p8);
SELECT [Id]
FROM [RunParticipantses]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 13:03:30.402 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 13:03:32.163 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 88218.5749ms.
2019-05-14 13:03:32.167 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:03:32.169 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 88256.6165ms
2019-05-14 13:03:32.172 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:03:32.175 +08:00 [INF] Request finished in 88274.7204ms 201 application/json; charset=utf-8
2019-05-14 13:04:09.629 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 13:04:09.634 +08:00 [INF] Successfully validated the token.
2019-05-14 13:04:09.635 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:04:09.638 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 13:04:09.642 +08:00 [INF] Authorization was successful.
2019-05-14 13:04:09.666 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 13:04:13.153 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:04:13.183 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 13:04:13.218 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:04:13.253 +08:00 [INF] 用户 1 删除队伍成功
2019-05-14 13:04:13.256 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 3586.9954000000002ms.
2019-05-14 13:04:13.258 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:04:13.260 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 3618.3471ms
2019-05-14 13:04:13.263 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:04:13.268 +08:00 [ERR] Connection id "0HLMO4USOFTS4", Request id "0HLMO4USOFTS4:00000011": An unhandled exception was thrown by the application.
System.InvalidOperationException: The connection does not support MultipleActiveResultSets.
   at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)
   at System.Data.SqlClient.SqlInternalTransaction.Rollback()
   at System.Data.SqlClient.SqlTransaction.Dispose(Boolean disposing)
   at System.Data.Common.DbTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ClearTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.EntityFrameworkCore.DbContext.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.AspNetCore.Hosting.Internal.RequestServicesFeature.Dispose()
   at Microsoft.AspNetCore.Http.HttpResponse.<>c.<.cctor>b__30_1(Object disposable)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.FireOnCompletedAwaited(Stack`1 onCompleted)
2019-05-14 13:04:13.285 +08:00 [INF] Request finished in 3655.8513ms 200 application/json; charset=utf-8
2019-05-14 13:04:13.367 +08:00 [INF] Executed DbCommand (141ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [RunTeams]
WHERE [Id] = @p0;
SELECT @@ROWCOUNT;
2019-05-14 13:04:13.404 +08:00 [INF] Executed DbCommand (21ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:04:33.785 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:04:33.788 +08:00 [INF] Successfully validated the token.
2019-05-14 13:04:33.790 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:04:33.792 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:04:33.799 +08:00 [INF] Authorization was successful.
2019-05-14 13:04:33.826 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:04:33.829 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:04:33.862 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:04:39.702 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:04:46.661 +08:00 [INF] Executed DbCommand (31ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:05:01.490 +08:00 [INF] Executed DbCommand (145ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 13:05:01.515 +08:00 [INF] Executed DbCommand (19ms) [Parameters=[@p5='?' (Size = 4000), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunParticipantses] ([Name], [RunTeamId], [Sex], [UserId])
VALUES (@p5, @p6, @p7, @p8);
SELECT [Id]
FROM [RunParticipantses]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 13:05:01.521 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 13:05:03.796 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 29966.4442ms.
2019-05-14 13:05:03.800 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:05:03.802 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 30002.3659ms
2019-05-14 13:05:03.804 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:05:03.806 +08:00 [INF] Request finished in 30021.4438ms 201 application/json; charset=utf-8
2019-05-14 13:05:15.117 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:05:15.122 +08:00 [INF] Successfully validated the token.
2019-05-14 13:05:15.125 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:05:15.126 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:05:15.131 +08:00 [INF] Authorization was successful.
2019-05-14 13:05:15.154 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:05:15.158 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:05:15.188 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:05:16.784 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:05:17.655 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 13:05:17.657 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 2499.1698ms.
2019-05-14 13:05:17.661 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:05:17.664 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 2532.8412000000003ms
2019-05-14 13:05:17.667 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:05:17.669 +08:00 [INF] Request finished in 2551.5816ms 500 application/json; charset=utf-8
2019-05-14 13:05:32.444 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:05:32.448 +08:00 [INF] Successfully validated the token.
2019-05-14 13:05:32.450 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:05:32.452 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:05:32.457 +08:00 [INF] Authorization was successful.
2019-05-14 13:05:32.489 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:05:32.496 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:05:32.525 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:05:32.557 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:05:32.563 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 13:05:32.564 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 67.8317ms.
2019-05-14 13:05:32.568 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:05:32.569 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 112.8061ms
2019-05-14 13:05:32.571 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:05:32.573 +08:00 [INF] Request finished in 129.0196ms 500 application/json; charset=utf-8
2019-05-14 13:05:37.036 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 13:05:37.039 +08:00 [INF] Successfully validated the token.
2019-05-14 13:05:37.040 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:05:37.043 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 13:05:37.047 +08:00 [INF] Authorization was successful.
2019-05-14 13:05:48.982 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 13:05:48.985 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:05:49.014 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 13:05:49.047 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:05:49.081 +08:00 [INF] 用户 1 删除队伍成功
2019-05-14 13:05:49.083 +08:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [RunTeams]
WHERE [Id] = @p0;
SELECT @@ROWCOUNT;
2019-05-14 13:05:49.083 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 98.34020000000001ms.
2019-05-14 13:05:49.110 +08:00 [INF] Executed DbCommand (22ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:05:49.112 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:05:49.120 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 12073.0506ms
2019-05-14 13:05:49.122 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:05:49.127 +08:00 [INF] Request finished in 12090.8856ms 200 application/json; charset=utf-8
2019-05-14 13:05:52.009 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 13:05:52.012 +08:00 [INF] Successfully validated the token.
2019-05-14 13:05:52.013 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:05:52.016 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 13:05:52.021 +08:00 [INF] Authorization was successful.
2019-05-14 13:05:52.045 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 13:05:52.048 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:05:52.075 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 13:05:52.109 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:05:52.115 +08:00 [INF] 用户 1 自身并没有创建队伍，删除失败！
2019-05-14 13:05:52.116 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 68.4593ms.
2019-05-14 13:05:52.120 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:05:52.123 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 101.884ms
2019-05-14 13:05:52.126 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:05:52.131 +08:00 [INF] Request finished in 121.7157ms 404 application/json; charset=utf-8
2019-05-14 13:05:56.923 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:05:56.926 +08:00 [INF] Successfully validated the token.
2019-05-14 13:05:56.940 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:05:56.946 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:05:56.952 +08:00 [INF] Authorization was successful.
2019-05-14 13:05:56.977 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:05:56.981 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:05:57.008 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:05:57.037 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:05:57.071 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 13:05:57.175 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 223.6493ms
2019-05-14 13:05:57.178 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:05:57.181 +08:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 13:05:57.195 +08:00 [INF] Executed DbCommand (152ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:05:57.216 +08:00 [INF] Request finished in 292.5371ms 500 text/html; charset=utf-8
2019-05-14 13:09:47.027 +08:00 [INF] User profile is available. Using 'C:\Users\10456\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2019-05-14 13:10:01.819 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html  
2019-05-14 13:10:02.115 +08:00 [INF] Request finished in 298.3857ms 200 text/html
2019-05-14 13:10:02.649 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json  
2019-05-14 13:10:02.858 +08:00 [INF] Request finished in 208.9549ms 200 application/json;charset=utf-8
2019-05-14 13:10:06.919 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Login/UserLoginApi application/json-patch+json 49
2019-05-14 13:10:07.006 +08:00 [INF] Executing endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 13:10:07.030 +08:00 [INF] Route matched with {action = "UserLoginApi", controller = "Login"}. Executing action Team.Controllers.LoginController.UserLoginApi (Team)
2019-05-14 13:10:07.506 +08:00 [INF] Executing action method Team.Controllers.LoginController.UserLoginApi (Team) with arguments (["Team.Model.AutoMappers.UserMapper.UserLoginMap"]) - Validation state: "Valid"
2019-05-14 13:10:07.721 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:10:08.020 +08:00 [INF] Executed DbCommand (52ms) [Parameters=[@__account_0='?' (Size = 4000), @__password_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE ([x].[Account] = @__account_0) AND ([x].[Password] = @__password_1)
2019-05-14 13:10:08.097 +08:00 [INF] 用户 1登陆成功
2019-05-14 13:10:08.104 +08:00 [INF] Executed action method Team.Controllers.LoginController.UserLoginApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 579.9761ms.
2019-05-14 13:10:08.117 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:10:08.131 +08:00 [INF] Executed action Team.Controllers.LoginController.UserLoginApi (Team) in 1096.251ms
2019-05-14 13:10:08.136 +08:00 [INF] Executed endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 13:10:08.145 +08:00 [INF] Request finished in 1226.4522ms 200 application/json; charset=utf-8
2019-05-14 13:10:24.438 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:10:24.460 +08:00 [INF] Successfully validated the token.
2019-05-14 13:10:24.466 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:10:24.477 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:10:24.492 +08:00 [INF] Authorization was successful.
2019-05-14 13:10:24.519 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:10:24.537 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:10:24.598 +08:00 [INF] Executed DbCommand (44ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:10:24.648 +08:00 [INF] Executed DbCommand (30ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:10:24.656 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 13:10:24.657 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 133.2966ms.
2019-05-14 13:10:24.662 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:10:24.675 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 193.3673ms
2019-05-14 13:10:24.680 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:10:24.682 +08:00 [INF] Request finished in 243.6855ms 500 application/json; charset=utf-8
2019-05-14 13:10:37.377 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:10:37.382 +08:00 [INF] Successfully validated the token.
2019-05-14 13:10:37.387 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:10:37.392 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:10:37.394 +08:00 [INF] Authorization was successful.
2019-05-14 13:10:37.429 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:10:37.434 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:10:37.468 +08:00 [INF] Executed DbCommand (27ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:10:37.506 +08:00 [INF] Executed DbCommand (27ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:10:37.660 +08:00 [INF] Executed DbCommand (90ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:10:37.725 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 13:10:37.768 +08:00 [INF] Executed DbCommand (29ms) [Parameters=[@p5='?' (Size = 4000), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunParticipantses] ([Name], [RunTeamId], [Sex], [UserId])
VALUES (@p5, @p6, @p7, @p8);
SELECT [Id]
FROM [RunParticipantses]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 13:10:37.779 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 13:10:44.680 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 7245.4355000000005ms.
2019-05-14 13:10:44.685 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:10:44.688 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 7293.5586ms
2019-05-14 13:10:44.692 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:10:44.695 +08:00 [INF] Request finished in 7317.971ms 201 application/json; charset=utf-8
2019-05-14 13:10:51.473 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 13:10:51.476 +08:00 [INF] Successfully validated the token.
2019-05-14 13:10:51.479 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:10:51.483 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 13:10:51.487 +08:00 [INF] Authorization was successful.
2019-05-14 13:10:51.515 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 13:10:51.522 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:10:51.569 +08:00 [INF] Executed DbCommand (36ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 13:10:51.600 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:10:51.650 +08:00 [INF] 用户 1 删除队伍成功
2019-05-14 13:10:51.652 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 132.8095ms.
2019-05-14 13:10:51.653 +08:00 [INF] Executed DbCommand (33ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [RunTeams]
WHERE [Id] = @p0;
SELECT @@ROWCOUNT;
2019-05-14 13:10:51.656 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:10:51.683 +08:00 [INF] Executed DbCommand (20ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:10:51.684 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 197.0183ms
2019-05-14 13:10:51.696 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:10:51.697 +08:00 [INF] Request finished in 224.4233ms 200 application/json; charset=utf-8
2019-05-14 13:10:55.544 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:10:55.547 +08:00 [INF] Successfully validated the token.
2019-05-14 13:10:55.548 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:10:55.550 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:10:55.558 +08:00 [INF] Authorization was successful.
2019-05-14 13:10:55.582 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:10:55.590 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:10:55.619 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:10:55.653 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:10:55.684 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:10:55.730 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 13:10:55.840 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 281.7282ms
2019-05-14 13:10:55.842 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:10:55.845 +08:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 13:10:55.914 +08:00 [INF] Request finished in 370.214ms 500 text/html; charset=utf-8
2019-05-14 13:10:58.503 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:10:58.508 +08:00 [INF] Successfully validated the token.
2019-05-14 13:10:58.509 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:10:58.511 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:10:58.513 +08:00 [INF] Authorization was successful.
2019-05-14 13:10:58.543 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:10:58.547 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:10:58.579 +08:00 [INF] Executed DbCommand (29ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:10:58.614 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:10:58.621 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 13:10:58.622 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 75.9813ms.
2019-05-14 13:10:58.627 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:10:58.629 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 115.77080000000001ms
2019-05-14 13:10:58.631 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:10:58.632 +08:00 [INF] Request finished in 129.0502ms 500 application/json; charset=utf-8
2019-05-14 13:11:08.637 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:11:08.640 +08:00 [INF] Successfully validated the token.
2019-05-14 13:11:08.642 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:11:08.646 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:11:08.654 +08:00 [INF] Authorization was successful.
2019-05-14 13:11:08.679 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:11:08.687 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:11:08.716 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:11:08.748 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:11:08.781 +08:00 [INF] Executed DbCommand (27ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:11:08.783 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 13:11:08.891 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 236.60590000000002ms
2019-05-14 13:11:08.893 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:11:08.895 +08:00 [ERR] An unhandled exception has occurred while executing the request.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Team.Infrastructure.Repositories.UnitOfWork.SaveChanged() in D:\Microsoft VS2017\Word\.net core API\Team\Team.Infrastructure\Repositories\UnitOfWork.cs:line 22
   at Team.Controllers.RunTeamController.RunTeamApi(RunTeamCreateMap runTeam) in D:\Microsoft VS2017\Word\.net core API\Team\Team\Controllers\RunTeamController.cs:line 76
   at Microsoft.AspNetCore.Mvc.Internal.ActionMethodExecutor.TaskOfIActionResultExecutor.Execute(IActionResultTypeMapper mapper, ObjectMethodExecutor executor, Object controller, Object[] arguments)
   at System.Threading.Tasks.ValueTask`1.get_Result()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeActionMethodAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeNextActionFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Rethrow(ActionExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ControllerActionInvoker.InvokeInnerFilterAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeNextResourceFilter()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Rethrow(ResourceExecutedContext context)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.Next(State& next, Scope& scope, Object& state, Boolean& isCompleted)
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeFilterPipelineAsync()
   at Microsoft.AspNetCore.Mvc.Internal.ResourceInvoker.InvokeAsync()
   at Microsoft.AspNetCore.Routing.EndpointMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Routing.EndpointRoutingMiddleware.Invoke(HttpContext httpContext)
   at Microsoft.AspNetCore.Authentication.AuthenticationMiddleware.Invoke(HttpContext context)
   at Microsoft.AspNetCore.StaticFiles.StaticFileMiddleware.Invoke(HttpContext context)
   at Swashbuckle.AspNetCore.SwaggerUI.SwaggerUIMiddleware.Invoke(HttpContext httpContext)
   at Swashbuckle.AspNetCore.Swagger.SwaggerMiddleware.Invoke(HttpContext httpContext, ISwaggerProvider swaggerProvider)
   at Microsoft.AspNetCore.Diagnostics.DeveloperExceptionPageMiddleware.Invoke(HttpContext context)
2019-05-14 13:11:08.933 +08:00 [INF] Request finished in 295.6552ms 500 text/html; charset=utf-8
2019-05-14 13:12:43.999 +08:00 [INF] User profile is available. Using 'C:\Users\10456\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2019-05-14 13:12:45.336 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html  
2019-05-14 13:12:45.669 +08:00 [INF] Request finished in 334.7716ms 200 text/html
2019-05-14 13:12:46.249 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json  
2019-05-14 13:12:46.434 +08:00 [INF] Request finished in 184.6044ms 200 application/json;charset=utf-8
2019-05-14 13:12:59.038 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Login/UserLoginApi application/json-patch+json 49
2019-05-14 13:12:59.124 +08:00 [INF] Executing endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 13:12:59.145 +08:00 [INF] Route matched with {action = "UserLoginApi", controller = "Login"}. Executing action Team.Controllers.LoginController.UserLoginApi (Team)
2019-05-14 13:12:59.784 +08:00 [INF] Executing action method Team.Controllers.LoginController.UserLoginApi (Team) with arguments (["Team.Model.AutoMappers.UserMapper.UserLoginMap"]) - Validation state: "Valid"
2019-05-14 13:13:00.011 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:13:00.312 +08:00 [INF] Executed DbCommand (46ms) [Parameters=[@__account_0='?' (Size = 4000), @__password_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE ([x].[Account] = @__account_0) AND ([x].[Password] = @__password_1)
2019-05-14 13:13:00.391 +08:00 [INF] 用户 1登陆成功
2019-05-14 13:13:00.397 +08:00 [INF] Executed action method Team.Controllers.LoginController.UserLoginApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 596.1395ms.
2019-05-14 13:13:00.411 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:13:00.423 +08:00 [INF] Executed action Team.Controllers.LoginController.UserLoginApi (Team) in 1274.3068ms
2019-05-14 13:13:00.427 +08:00 [INF] Executed endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 13:13:00.435 +08:00 [INF] Request finished in 1396.95ms 200 application/json; charset=utf-8
2019-05-14 13:13:13.188 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:13:13.207 +08:00 [INF] Successfully validated the token.
2019-05-14 13:13:13.211 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:13:13.218 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:13:13.232 +08:00 [INF] Authorization was successful.
2019-05-14 13:13:13.262 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:13:13.270 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:13:13.331 +08:00 [INF] Executed DbCommand (42ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:13:13.383 +08:00 [INF] Executed DbCommand (29ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:13:13.578 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 13:13:13.592 +08:00 [INF] Executed DbCommand (154ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:13:13.692 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 13:13:22.324 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 9058.4009ms.
2019-05-14 13:13:22.329 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:13:22.331 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 9106.4841ms
2019-05-14 13:13:22.334 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:13:22.338 +08:00 [INF] Request finished in 9150.2712ms 201 application/json; charset=utf-8
2019-05-14 13:13:31.601 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 13:13:31.604 +08:00 [INF] Successfully validated the token.
2019-05-14 13:13:31.606 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:13:31.611 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 13:13:31.616 +08:00 [INF] Authorization was successful.
2019-05-14 13:13:31.646 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 13:13:31.653 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:13:31.704 +08:00 [INF] Executed DbCommand (35ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 13:13:31.734 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:13:31.740 +08:00 [INF] 用户 1 自身并没有创建队伍，删除失败！
2019-05-14 13:13:31.741 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 90.3767ms.
2019-05-14 13:13:31.743 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:13:31.747 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 131.5033ms
2019-05-14 13:13:31.750 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:13:31.755 +08:00 [INF] Request finished in 154.0699ms 404 application/json; charset=utf-8
2019-05-14 13:13:36.440 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 13:13:36.443 +08:00 [INF] Successfully validated the token.
2019-05-14 13:13:36.444 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:13:36.447 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 13:13:36.455 +08:00 [INF] Authorization was successful.
2019-05-14 13:13:36.479 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 13:13:36.485 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:13:36.511 +08:00 [INF] Executed DbCommand (23ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 13:13:36.540 +08:00 [INF] Executed DbCommand (22ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:13:36.547 +08:00 [INF] 用户 1 自身并没有创建队伍，删除失败！
2019-05-14 13:13:36.549 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 64.1863ms.
2019-05-14 13:13:36.552 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:13:36.554 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 99.132200000000012ms
2019-05-14 13:13:36.556 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:13:36.558 +08:00 [INF] Request finished in 117.7427ms 404 application/json; charset=utf-8
2019-05-14 13:13:59.518 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:13:59.523 +08:00 [INF] Successfully validated the token.
2019-05-14 13:13:59.526 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:13:59.530 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:13:59.534 +08:00 [INF] Authorization was successful.
2019-05-14 13:13:59.557 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:13:59.564 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:13:59.594 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:13:59.628 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:13:59.633 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 13:13:59.634 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 70.4599ms.
2019-05-14 13:13:59.637 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:13:59.640 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 105.62270000000001ms
2019-05-14 13:13:59.643 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:13:59.645 +08:00 [INF] Request finished in 127.1093ms 500 application/json; charset=utf-8
2019-05-14 13:14:25.620 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:14:25.624 +08:00 [INF] Successfully validated the token.
2019-05-14 13:14:25.626 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:14:25.629 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:14:25.633 +08:00 [INF] Authorization was successful.
2019-05-14 13:14:25.659 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:14:25.667 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:14:25.701 +08:00 [INF] Executed DbCommand (29ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:14:35.495 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:14:35.531 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 13:14:59.928 +08:00 [INF] Executed DbCommand (24,427ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:15:04.132 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 13:15:04.141 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 38474.4292ms.
2019-05-14 13:15:04.146 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:15:04.148 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 38514.538400000005ms
2019-05-14 13:15:04.162 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:15:04.164 +08:00 [INF] Request finished in 38544.7656ms 201 application/json; charset=utf-8
2019-05-14 13:15:29.243 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:15:29.247 +08:00 [INF] Successfully validated the token.
2019-05-14 13:15:29.249 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:15:29.255 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:15:29.261 +08:00 [INF] Authorization was successful.
2019-05-14 13:15:29.293 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:15:29.299 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:15:29.330 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:15:48.347 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:16:24.223 +08:00 [INF] Executed DbCommand (35,867ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:16:27.231 +08:00 [ERR] An exception occurred in the database while saving changes for context type 'Team.Infrastructure.DbContext.MyContext'.
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
System.InvalidOperationException: A second operation started on this context before a previous operation completed. This is usually caused by different threads using the same instance of DbContext, however instance members are not guaranteed to be thread safe. This could also be caused by a nested query being evaluated on the client, if this is the case rewrite the query avoiding nested invocations.
   at Microsoft.EntityFrameworkCore.Internal.ConcurrencyDetector.EnterCriticalSection()
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(IReadOnlyList`1 entriesToSave, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.ChangeTracking.Internal.StateManager.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
   at Microsoft.EntityFrameworkCore.DbContext.SaveChangesAsync(Boolean acceptAllChangesOnSuccess, CancellationToken cancellationToken)
2019-05-14 13:16:56.598 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 13:16:56.602 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 87303.0438ms.
2019-05-14 13:16:56.604 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:16:56.607 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 87346.5114ms
2019-05-14 13:16:56.610 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:16:56.612 +08:00 [INF] Request finished in 87369.042ms 201 application/json; charset=utf-8
2019-05-14 13:18:14.679 +08:00 [INF] User profile is available. Using 'C:\Users\10456\AppData\Local\ASP.NET\DataProtection-Keys' as key repository and Windows DPAPI to encrypt keys at rest.
2019-05-14 13:18:16.004 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/index.html  
2019-05-14 13:18:16.307 +08:00 [INF] Request finished in 304.8247ms 200 text/html
2019-05-14 13:18:16.863 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/swagger/v1/swagger.json  
2019-05-14 13:18:17.044 +08:00 [INF] Request finished in 180.5867ms 200 application/json;charset=utf-8
2019-05-14 13:18:21.183 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/Login/UserLoginApi application/json-patch+json 49
2019-05-14 13:18:21.271 +08:00 [INF] Executing endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 13:18:21.293 +08:00 [INF] Route matched with {action = "UserLoginApi", controller = "Login"}. Executing action Team.Controllers.LoginController.UserLoginApi (Team)
2019-05-14 13:18:21.869 +08:00 [INF] Executing action method Team.Controllers.LoginController.UserLoginApi (Team) with arguments (["Team.Model.AutoMappers.UserMapper.UserLoginMap"]) - Validation state: "Valid"
2019-05-14 13:18:22.105 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:18:22.463 +08:00 [INF] Executed DbCommand (54ms) [Parameters=[@__account_0='?' (Size = 4000), @__password_1='?' (Size = 4000)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE ([x].[Account] = @__account_0) AND ([x].[Password] = @__password_1)
2019-05-14 13:18:22.553 +08:00 [INF] 用户 1登陆成功
2019-05-14 13:18:22.558 +08:00 [INF] Executed action method Team.Controllers.LoginController.UserLoginApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 673.4124ms.
2019-05-14 13:18:22.571 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:18:22.585 +08:00 [INF] Executed action Team.Controllers.LoginController.UserLoginApi (Team) in 1285.4624000000001ms
2019-05-14 13:18:22.589 +08:00 [INF] Executed endpoint 'Team.Controllers.LoginController.UserLoginApi (Team)'
2019-05-14 13:18:22.596 +08:00 [INF] Request finished in 1413.0209ms 200 application/json; charset=utf-8
2019-05-14 13:18:40.396 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:18:40.412 +08:00 [INF] Successfully validated the token.
2019-05-14 13:18:40.415 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:18:40.420 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:18:40.431 +08:00 [INF] Authorization was successful.
2019-05-14 13:18:40.456 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:18:40.463 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:18:40.523 +08:00 [INF] Executed DbCommand (46ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:18:44.901 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:18:48.625 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 13:18:48.625 +08:00 [INF] Executed DbCommand (1,422ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 13:18:48.628 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 8168.5552000000007ms.
2019-05-14 13:18:48.634 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:18:48.636 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 8214.6446ms
2019-05-14 13:18:48.638 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:18:48.643 +08:00 [ERR] Connection id "0HLMO5E8K2RN0", Request id "0HLMO5E8K2RN0:00000004": An unhandled exception was thrown by the application.
System.InvalidOperationException: There is already an open DataReader associated with this Command which must be closed first.
   at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)
   at System.Data.SqlClient.SqlInternalTransaction.Rollback()
   at System.Data.SqlClient.SqlTransaction.Dispose(Boolean disposing)
   at System.Data.Common.DbTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ClearTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.EntityFrameworkCore.DbContext.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.AspNetCore.Hosting.Internal.RequestServicesFeature.Dispose()
   at Microsoft.AspNetCore.Http.HttpResponse.<>c.<.cctor>b__30_1(Object disposable)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.FireOnCompletedAwaited(Stack`1 onCompleted)
2019-05-14 13:18:48.732 +08:00 [INF] Executed DbCommand (43ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:18:48.759 +08:00 [INF] Request finished in 8362.7329ms 201 application/json; charset=utf-8
2019-05-14 13:18:48.919 +08:00 [INF] Executed DbCommand (155ms) [Parameters=[@p10='?' (Size = 4000), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunParticipantses] ([Name], [RunTeamId], [Sex], [UserId])
VALUES (@p10, @p11, @p12, @p13);
SELECT [Id]
FROM [RunParticipantses]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 13:19:08.476 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:19:08.479 +08:00 [INF] Successfully validated the token.
2019-05-14 13:19:08.483 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:19:08.487 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:19:08.492 +08:00 [INF] Authorization was successful.
2019-05-14 13:19:08.528 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:19:08.532 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:19:08.569 +08:00 [INF] Executed DbCommand (30ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:19:12.125 +08:00 [INF] Executed DbCommand (30ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:19:12.638 +08:00 [INF] 用户 1 创建跑步队伍失败
2019-05-14 13:19:12.640 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 4108.3427ms.
2019-05-14 13:19:12.644 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:19:12.646 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 4154.6727ms
2019-05-14 13:19:12.648 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:19:12.649 +08:00 [INF] Request finished in 4173.2282ms 500 application/json; charset=utf-8
2019-05-14 13:19:19.869 +08:00 [INF] Request starting HTTP/1.1 GET http://localhost:5000/api/RunTeam/SearchTeamApi  
2019-05-14 13:19:19.873 +08:00 [INF] Successfully validated the token.
2019-05-14 13:19:19.876 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:19:19.882 +08:00 [INF] Route matched with {action = "DeleteTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.DeleteTeamApi (Team)
2019-05-14 13:19:19.885 +08:00 [INF] Authorization was successful.
2019-05-14 13:19:19.912 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.DeleteTeamApi (Team) - Validation state: "Valid"
2019-05-14 13:19:19.916 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:19:19.954 +08:00 [INF] Executed DbCommand (28ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Count], [x].[CreationTime], [x].[Introduction], [x].[Name], [x].[UserId]
FROM [RunTeams] AS [x]
WHERE [x].[UserId] = @__userId_0
2019-05-14 13:19:19.985 +08:00 [INF] Executed DbCommand (25ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:19:20.024 +08:00 [INF] 用户 1 删除队伍成功
2019-05-14 13:19:20.026 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.DeleteTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 112.1498ms.
2019-05-14 13:19:20.030 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:19:20.031 +08:00 [INF] Executed action Team.Controllers.RunTeamController.DeleteTeamApi (Team) in 145.589ms
2019-05-14 13:19:20.033 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.DeleteTeamApi (Team)'
2019-05-14 13:19:20.035 +08:00 [ERR] Connection id "0HLMO5E8K2RN0", Request id "0HLMO5E8K2RN0:00000006": An unhandled exception was thrown by the application.
System.InvalidOperationException: The connection does not support MultipleActiveResultSets.
   at System.Data.SqlClient.SqlInternalConnectionTds.ValidateConnectionForExecute(SqlCommand command)
   at System.Data.SqlClient.SqlInternalTransaction.Rollback()
   at System.Data.SqlClient.SqlTransaction.Dispose(Boolean disposing)
   at System.Data.Common.DbTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalTransaction.Dispose()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.ClearTransactions()
   at Microsoft.EntityFrameworkCore.Storage.RelationalConnection.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.EntityFrameworkCore.DbContext.Dispose()
   at Microsoft.Extensions.DependencyInjection.ServiceLookup.ServiceProviderEngineScope.Dispose()
   at Microsoft.AspNetCore.Hosting.Internal.RequestServicesFeature.Dispose()
   at Microsoft.AspNetCore.Http.HttpResponse.<>c.<.cctor>b__30_1(Object disposable)
   at Microsoft.AspNetCore.Server.Kestrel.Core.Internal.Http.HttpProtocol.FireOnCompletedAwaited(Stack`1 onCompleted)
2019-05-14 13:19:20.044 +08:00 [INF] Request finished in 175.5568ms 200 application/json; charset=utf-8
2019-05-14 13:19:20.200 +08:00 [INF] Executed DbCommand (202ms) [Parameters=[@p0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
DELETE FROM [RunTeams]
WHERE [Id] = @p0;
SELECT @@ROWCOUNT;
2019-05-14 13:19:20.230 +08:00 [INF] Executed DbCommand (22ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:19:32.153 +08:00 [INF] Request starting HTTP/1.1 POST http://localhost:5000/api/RunTeam/RunTeamApi application/json-patch+json 50
2019-05-14 13:19:32.156 +08:00 [INF] Successfully validated the token.
2019-05-14 13:19:32.159 +08:00 [INF] Executing endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:19:32.161 +08:00 [INF] Route matched with {action = "RunTeamApi", controller = "RunTeam"}. Executing action Team.Controllers.RunTeamController.RunTeamApi (Team)
2019-05-14 13:19:32.166 +08:00 [INF] Authorization was successful.
2019-05-14 13:19:32.191 +08:00 [INF] Executing action method Team.Controllers.RunTeamController.RunTeamApi (Team) with arguments (["Team.Model.AutoMappers.RunTeamMapper.RunTeamCreateMap"]) - Validation state: "Valid"
2019-05-14 13:19:32.195 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 13:19:32.231 +08:00 [INF] Executed DbCommand (26ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:19:36.760 +08:00 [INF] Executed DbCommand (24ms) [Parameters=[@__userId_0='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SELECT TOP(2) [x].[Id], [x].[Account], [x].[Name], [x].[Password], [x].[Province], [x].[Role], [x].[RunTeamState], [x].[Sex], [x].[StudentId], [x].[UniversityId]
FROM [Users] AS [x]
WHERE [x].[Id] = @__userId_0
2019-05-14 13:19:39.355 +08:00 [INF] Executed DbCommand (29ms) [Parameters=[@p0='?' (DbType = Int32), @p1='?' (DbType = DateTime2), @p2='?' (Size = 4000), @p3='?' (Size = 4000), @p4='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunTeams] ([Count], [CreationTime], [Introduction], [Name], [UserId])
VALUES (@p0, @p1, @p2, @p3, @p4);
SELECT [Id]
FROM [RunTeams]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 13:19:39.356 +08:00 [INF] 用户 1 创建跑步队伍成功
2019-05-14 13:19:39.376 +08:00 [INF] Executed DbCommand (16ms) [Parameters=[@p9='?' (DbType = Int32), @p0='?' (Size = 4000), @p1='?' (Size = 4000), @p2='?' (Size = 4000), @p3='?' (DbType = Int32), @p4='?' (DbType = Int32), @p5='?' (DbType = Int32), @p6='?' (DbType = Int32), @p7='?' (DbType = Int32), @p8='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
UPDATE [Users] SET [Account] = @p0, [Name] = @p1, [Password] = @p2, [Province] = @p3, [Role] = @p4, [RunTeamState] = @p5, [Sex] = @p6, [StudentId] = @p7, [UniversityId] = @p8
WHERE [Id] = @p9;
SELECT @@ROWCOUNT;
2019-05-14 13:19:39.377 +08:00 [INF] Executed action method Team.Controllers.RunTeamController.RunTeamApi (Team), returned result Microsoft.AspNetCore.Mvc.ObjectResult in 7181.6154000000006ms.
2019-05-14 13:19:39.400 +08:00 [INF] Executed DbCommand (19ms) [Parameters=[@p10='?' (Size = 4000), @p11='?' (DbType = Int32), @p12='?' (DbType = Int32), @p13='?' (DbType = Int32)], CommandType='"Text"', CommandTimeout='30']
SET NOCOUNT ON;
INSERT INTO [RunParticipantses] ([Name], [RunTeamId], [Sex], [UserId])
VALUES (@p10, @p11, @p12, @p13);
SELECT [Id]
FROM [RunParticipantses]
WHERE @@ROWCOUNT = 1 AND [Id] = scope_identity();
2019-05-14 13:19:39.403 +08:00 [INF] Executing ObjectResult, writing value of type 'Team.Model.CustomStatusCode'.
2019-05-14 13:19:39.411 +08:00 [INF] Executed action Team.Controllers.RunTeamController.RunTeamApi (Team) in 7245.7621ms
2019-05-14 13:19:39.413 +08:00 [INF] Executed endpoint 'Team.Controllers.RunTeamController.RunTeamApi (Team)'
2019-05-14 13:19:39.415 +08:00 [INF] Request finished in 7261.5244ms 201 application/json; charset=utf-8
2019-05-14 23:12:46.816 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 23:13:15.348 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 23:13:25.516 +08:00 [INF] Entity Framework Core 2.2.3-servicing-35854 initialized 'MyContext' using provider 'Microsoft.EntityFrameworkCore.SqlServer' with options: None
2019-05-14 23:13:26.182 +08:00 [INF] Executed DbCommand (221ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2019-05-14 23:13:26.188 +08:00 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT OBJECT_ID(N'[__EFMigrationsHistory]');
2019-05-14 23:13:26.372 +08:00 [INF] Executed DbCommand (181ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT [MigrationId], [ProductVersion]
FROM [__EFMigrationsHistory]
ORDER BY [MigrationId];
2019-05-14 23:13:26.381 +08:00 [INF] Applying migration '20190514151315_AddRunTeam'.
2019-05-14 23:13:26.750 +08:00 [INF] Executed DbCommand (325ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE [RunTeamRecords] (
    [Id] int NOT NULL IDENTITY,
    [DateTime] date NOT NULL,
    [Distance] real NOT NULL,
    [Calories] real NOT NULL,
    [RunTeamId] int NOT NULL,
    CONSTRAINT [PK_RunTeamRecords] PRIMARY KEY ([Id]),
    CONSTRAINT [FK_RunTeamRecords_RunTeams_RunTeamId] FOREIGN KEY ([RunTeamId]) REFERENCES [RunTeams] ([Id]) ON DELETE CASCADE
);
2019-05-14 23:13:26.831 +08:00 [INF] Executed DbCommand (80ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX [IX_RunTeamRecords_RunTeamId] ON [RunTeamRecords] ([RunTeamId]);
2019-05-14 23:13:26.948 +08:00 [INF] Executed DbCommand (117ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO [__EFMigrationsHistory] ([MigrationId], [ProductVersion])
VALUES (N'20190514151315_AddRunTeam', N'2.2.3-servicing-35854');
